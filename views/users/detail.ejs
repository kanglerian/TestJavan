<!DOCTYPE html>
<html>

<head>
  <title><%= title %></title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/aset">Aset</a></li>
    <li><a href="/users">User</a></li>
  </ul>
  <a href="/users/<%= nama.idParent %>">Kembali</a>
  <h2>Halo, ini <%= nama.nama %></h2>
  <% if(url != '/users'){ %>
  <p>Ini adalah daftar aset yang dimiliki <b><%= nama.nama %></b>:</p>
  <button onclick="addAset()">Add Asset</button>
  <div style="margin-top: 10px;display: none;" id="add-aset">
    <form action="/users/aset" method="POST">
      <input type="hidden" name="idUser" value="<%= user %>">
      <input type="hidden" name="price" id="price">
      <select name="namaAset" id="aset" onchange="changeProduct(this.options[this.selectedIndex].getAttribute('data-price'))">
        <option>Pilih</option>
        <% products.forEach((product,i) => { %>
        <option value="<%= product.title %>" data-price="<%= product.price %>"><%=  product.title %></option>
        <% }); %>
      </select>
      <button type="submit">save</button>
    </form>
  </div>
  <table style="margin-top: 10px;">
    <tr>
      <th>No</th>
      <th>Title</th>
      <th>Price</th>
      <th>#</th>
    </tr>
    <% var totalPrice = 0; %>
    <% if(asets.length > 0){ %>
    <% asets.forEach((aset,i) => { %>
    <tr>
      <td><%= i + 1 %></td>
      <form action="/users/aset/<%= aset.id %>?_method=PATCH" method="POST">
      <td>
        <span id="namaAsetLabel<%= aset.id %>" style="display:block"><%= aset.namaAset %></span>
        <input type="text" name="namaAset" value="<%= aset.namaAset %>" id="namaAset<%= aset.id %>"  style="display:none">
      </td>
      <td>
        <span id="priceLabel<%= aset.id %>" style="display:block">$<%= aset.price.toLocaleString('en-US')%></span>
        <input type="text" name="price" value="<%= aset.price %>" id="price<%= aset.id %>"  style="display:none">
        <% totalPrice += aset.price %>
      </td>
      <td>
        <button type="submit" style="display:none" id="save<%= aset.id %>">save</button>
      </form>
      <button onclick="editForm(`<%= aset.id %>`)">edit</button>
        <form style="display: inline;" action="/users/aset/<%= aset.id %>?_method=DELETE" method="POST">
          <button type="submit">hapus</button>
        </form>
      </td>
    </tr>
    <% }); %>
    <% } else { %>
      <tr>
        <td colspan="4">Belum ada aset yang dimiliki</td>
      </tr>
    <% } %>
  </table>
  <p>Total Price: $<%= totalPrice.toLocaleString('en-US') %></p>
  <%}%>

  <p>Ini adalah daftar keluarga <b><%= nama.nama %></b>:</p>
  <button onclick="addKeluarga()">Add Keluarga</button>
  <div style="margin-top: 10px;display: none;" id="add-keluarga">
    <form action="/users/keluarga" method="POST">
      <input type="hidden" name="idParent" value="<%= nama.id %>">
      <input type="text" name="nama" placeholder="Input name in here..">
      <select name="jeniskelamin">
        <option value="1">Laki-laki</option>
        <option value="0">Perempuan</option>
      </select>
      <button type="submit">save</button>
    </form>
  </div>
  <table style="margin-top: 10px">
    <tr>
      <th>No</th>
      <th>Nama</th>
      <th>Jenis Kelamin</th>
      <th>#</th>
    </tr>
    <% if(families.length > 0){ %>
    <% families.forEach((family,i) => { %>
      <tr>
        <td><%= i + 1 %></td>
        <form action="/users/<%= family.id %>?_method=PATCH" method="POST">
        <td>
          <a href="/users/<%= family.id %>" id="namaLabel<%= family.id %>" style="display:block"><%= family.nama %></a>
          <input type="text" name="nama" value="<%= family.nama %>" id="nama<%= family.id %>" style="display:none">
        </td>
        <td>
          <span id="jkLabel<%= family.id %>" style="display:block"><%= family.jeniskelamin == true ? 'Laki-laki' : 'Perempuan' %></span>
          <select name="jeniskelamin" id="jk<%= family.id %>" style="display:none">
            <option value="<%= family.jeniskelamin == true ? 1 : 0 %>" selected><%= family.jeniskelamin == true ? 'Laki-laki' : 'Perempuan' %></option>
            <option value="<%= family.jeniskelamin == true ? 0 : 1 %>"><%= family.jeniskelamin == true ? 'Perempuan' : 'Laki-laki' %></option>
          </select>
        </td>
        <td>
          <button type="submit" style="display:none" id="save<%= family.id %>">save</button>
        </form>
          <button onclick="editForm(`<%= family.id %>`)">edit</button>
          <form style="display: inline;" action="/users/<%= family.id %>?_method=DELETE" method="POST">
            <button type="submit">hapus</button>
          </form>
        </td>
      </tr>
    <% }); %>
    <% } else { %>
      <tr>
        <td colspan="4">Belum ada keluarga yang dimiliki</td>
      </tr>
    <% } %>
  </table>

  <script>
    function changeProduct(data) {
      const price = document.getElementById('price').value = data;
    }

    function addAset() {
      const form = document.getElementById('add-aset');
      if (form.style.display == 'none') {
        form.style.display = 'block';
      } else {
        form.style.display = 'none';
      }
    }

    function addKeluarga() {
      const form = document.getElementById('add-keluarga');
      if (form.style.display == 'none') {
        form.style.display = 'block';
      } else {
        form.style.display = 'none';
      }
    }

    const editForm = (da) => {
      let namaAset = document.getElementById(`namaAset${da}`);
      let namaAsetLabel = document.getElementById(`namaAsetLabel${da}`);
      let price = document.getElementById(`price${da}`);
      let priceLabel = document.getElementById(`priceLabel${da}`);
      let save = document.getElementById(`save${da}`);
      if(namaAset.style.display == "none"){
        namaAset.style.display = "block";
        namaAsetLabel.style.display = "none";
        price.style.display = "block";
        priceLabel.style.display = "none";
        save.style.display = "inline";
      }else{
        namaAset.style.display = "none";
        namaAsetLabel.style.display = "block";
        price.style.display = "none";
        priceLabel.style.display = "block";
        save.style.display = "none";
      }
    }
  </script>
</body>

</html>